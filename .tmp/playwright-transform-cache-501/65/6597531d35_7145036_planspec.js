"use strict";

var _test = require("@playwright/test");
const seed = {
  city: "大阪",
  startDate: "2025-11-06",
  endDate: "2025-11-10",
  purposes: ["観光", "グルメ", "宿泊"],
  hotelName: "ホテルモントレ大阪",
  mustSee: ["USJ", "カニ道楽 本店", "アメリカ村（アメ村）", "通天閣", "大阪城", "梅田スカイビル 空中庭園", "道頓堀", "黒門市場", "海遊館"],
  policy: "nomal" // 誤記も normal として扱われるか
};
function isMain(i) {
  var _i$type;
  const t = (_i$type = i === null || i === void 0 ? void 0 : i.type) !== null && _i$type !== void 0 ? _i$type : "";
  return !(t === "グルメ" || t === "移動" || t === "プレースホルダ");
}
(0, _test.test)('B方針: 各日メイン2枠固定 & ランチ/夕食重複なし & 到着/出発移動あり', async ({
  request,
  baseURL
}) => {
  const res = await request.post(`${baseURL}/api/plan`, {
    data: seed,
    headers: {
      'content-type': 'application/json'
    }
  });
  (0, _test.expect)(res.ok()).toBeTruthy();
  const json = await res.json();

  // dayキーを抽出・昇順
  const dayKeys = Object.keys(json).filter(k => /^day\d+$/.test(k)).sort((a, b) => Number(a.slice(3)) - Number(b.slice(3)));
  (0, _test.expect)(dayKeys.length).toBeGreaterThan(0);

  // 1) 各日メイン2件
  for (const k of dayKeys) {
    const mainCount = (json[k] || []).filter(isMain).length;
    (0, _test.expect)(mainCount, `${k} main count`).toBe(2);
  }

  // 2) ランチ/夕食の時刻重複なし
  for (const k of dayKeys) {
    const meals = (json[k] || []).filter(i => {
      var _i$title;
      return /ランチ|夕食/.test((_i$title = i === null || i === void 0 ? void 0 : i.title) !== null && _i$title !== void 0 ? _i$title : '');
    });
    const times = meals.map(i => i.time);
    const uniq = Array.from(new Set(times));
    (0, _test.expect)(uniq.length, `${k} meal time unique`).toBe(times.length);
  }

  // 3) 到着/出発の移動行が入っている
  const day1 = json[dayKeys[0]] || [];
  const last = json[dayKeys[dayKeys.length - 1]] || [];
  (0, _test.expect)(day1.some(i => {
    var _i$title2;
    return /移動（到着）/.test((_i$title2 = i === null || i === void 0 ? void 0 : i.title) !== null && _i$title2 !== void 0 ? _i$title2 : '');
  })).toBeTruthy();
  (0, _test.expect)(last.some(i => {
    var _i$title3;
    return /移動（出発）/.test((_i$title3 = i === null || i === void 0 ? void 0 : i.title) !== null && _i$title3 !== void 0 ? _i$title3 : '');
  })).toBeTruthy();

  // 4) distanceHint が付与されている（観光系のどれかに数値）
  const hasHint = dayKeys.some(k => (json[k] || []).some(i => {
    var _i$meta$distanceHint, _i$meta;
    return ((_i$meta$distanceHint = i === null || i === void 0 || (_i$meta = i.meta) === null || _i$meta === void 0 ? void 0 : _i$meta.distanceHint) !== null && _i$meta$distanceHint !== void 0 ? _i$meta$distanceHint : 999) !== 999;
  }));
  (0, _test.expect)(hasHint).toBeTruthy();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdGVzdCIsInJlcXVpcmUiLCJzZWVkIiwiY2l0eSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJwdXJwb3NlcyIsImhvdGVsTmFtZSIsIm11c3RTZWUiLCJwb2xpY3kiLCJpc01haW4iLCJpIiwiX2kkdHlwZSIsInQiLCJ0eXBlIiwidGVzdCIsInJlcXVlc3QiLCJiYXNlVVJMIiwicmVzIiwicG9zdCIsImRhdGEiLCJoZWFkZXJzIiwiZXhwZWN0Iiwib2siLCJ0b0JlVHJ1dGh5IiwianNvbiIsImRheUtleXMiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwiayIsInNvcnQiLCJhIiwiYiIsIk51bWJlciIsInNsaWNlIiwibGVuZ3RoIiwidG9CZUdyZWF0ZXJUaGFuIiwibWFpbkNvdW50IiwidG9CZSIsIm1lYWxzIiwiX2kkdGl0bGUiLCJ0aXRsZSIsInRpbWVzIiwibWFwIiwidGltZSIsInVuaXEiLCJBcnJheSIsImZyb20iLCJTZXQiLCJkYXkxIiwibGFzdCIsInNvbWUiLCJfaSR0aXRsZTIiLCJfaSR0aXRsZTMiLCJoYXNIaW50IiwiX2kkbWV0YSRkaXN0YW5jZUhpbnQiLCJfaSRtZXRhIiwibWV0YSIsImRpc3RhbmNlSGludCJdLCJzb3VyY2VzIjpbInBsYW4uc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0ZXN0LCBleHBlY3QgfSBmcm9tICdAcGxheXdyaWdodC90ZXN0JztcblxuY29uc3Qgc2VlZCA9IHtcbiAgY2l0eTogXCLlpKfpmKpcIixcbiAgc3RhcnREYXRlOiBcIjIwMjUtMTEtMDZcIixcbiAgZW5kRGF0ZTogXCIyMDI1LTExLTEwXCIsXG4gIHB1cnBvc2VzOiBbXCLoprPlhYlcIixcIuOCsOODq+ODoVwiLFwi5a6/5rOKXCJdLFxuICBob3RlbE5hbWU6IFwi44Ob44OG44Or44Oi44Oz44OI44Os5aSn6ZiqXCIsXG4gIG11c3RTZWU6IFtcIlVTSlwiLFwi44Kr44OL6YGT5qW9IOacrOW6l1wiLFwi44Ki44Oh44Oq44Kr5p2R77yI44Ki44Oh5p2R77yJXCIsXCLpgJrlpKnplqNcIixcIuWkp+mYquWfjlwiLFwi5qKF55Sw44K544Kr44Kk44OT44OrIOepuuS4reW6reWcklwiLFwi6YGT6aCT5aCAXCIsXCLpu5LploDluILloLRcIixcIua1t+mBiumkqFwiXSxcbiAgcG9saWN5OiBcIm5vbWFsXCIgLy8g6Kqk6KiY44KCIG5vcm1hbCDjgajjgZfjgabmibHjgo/jgozjgovjgYtcbn07XG5cbmZ1bmN0aW9uIGlzTWFpbihpOiBhbnkpIHtcbiAgY29uc3QgdCA9IGk/LnR5cGUgPz8gXCJcIjtcbiAgcmV0dXJuICEodCA9PT0gXCLjgrDjg6vjg6FcIiB8fCB0ID09PSBcIuenu+WLlVwiIHx8IHQgPT09IFwi44OX44Os44O844K544Ob44Or44OAXCIpO1xufVxuXG50ZXN0KCdC5pa56YedOiDlkITml6Xjg6HjgqTjg7My5p6g5Zu65a6aICYg44Op44Oz44OBL+Wklemjn+mHjeikh+OBquOBlyAmIOWIsOedgC/lh7rnmbrnp7vli5XjgYLjgoonLCBhc3luYyAoeyByZXF1ZXN0LCBiYXNlVVJMIH0pID0+IHtcbiAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdC5wb3N0KGAke2Jhc2VVUkx9L2FwaS9wbGFuYCwge1xuICAgIGRhdGE6IHNlZWQsXG4gICAgaGVhZGVyczogeyAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cbiAgfSk7XG4gIGV4cGVjdChyZXMub2soKSkudG9CZVRydXRoeSgpO1xuXG4gIGNvbnN0IGpzb24gPSBhd2FpdCByZXMuanNvbigpO1xuXG4gIC8vIGRheeOCreODvOOCkuaKveWHuuODu+aYh+mghlxuICBjb25zdCBkYXlLZXlzID0gT2JqZWN0LmtleXMoanNvbikuZmlsdGVyKGsgPT4gL15kYXlcXGQrJC8udGVzdChrKSkuc29ydCgoYSxiKT0+TnVtYmVyKGEuc2xpY2UoMykpLU51bWJlcihiLnNsaWNlKDMpKSk7XG4gIGV4cGVjdChkYXlLZXlzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gIC8vIDEpIOWQhOaXpeODoeOCpOODszLku7ZcbiAgZm9yIChjb25zdCBrIG9mIGRheUtleXMpIHtcbiAgICBjb25zdCBtYWluQ291bnQgPSAoanNvbltrXSB8fCBbXSkuZmlsdGVyKGlzTWFpbikubGVuZ3RoO1xuICAgIGV4cGVjdChtYWluQ291bnQsIGAke2t9IG1haW4gY291bnRgKS50b0JlKDIpO1xuICB9XG5cbiAgLy8gMikg44Op44Oz44OBL+Wklemjn+OBruaZguWIu+mHjeikh+OBquOBl1xuICBmb3IgKGNvbnN0IGsgb2YgZGF5S2V5cykge1xuICAgIGNvbnN0IG1lYWxzID0gKGpzb25ba10gfHwgW10pLmZpbHRlcigoaTogYW55KSA9PiAv44Op44Oz44OBfOWklemjny8udGVzdChpPy50aXRsZSA/PyAnJykpO1xuICAgIGNvbnN0IHRpbWVzID0gbWVhbHMubWFwKChpOiBhbnkpID0+IGkudGltZSk7XG4gICAgY29uc3QgdW5pcSA9IEFycmF5LmZyb20obmV3IFNldCh0aW1lcykpO1xuICAgIGV4cGVjdCh1bmlxLmxlbmd0aCwgYCR7a30gbWVhbCB0aW1lIHVuaXF1ZWApLnRvQmUodGltZXMubGVuZ3RoKTtcbiAgfVxuXG4gIC8vIDMpIOWIsOedgC/lh7rnmbrjga7np7vli5XooYzjgYzlhaXjgaPjgabjgYTjgotcbiAgY29uc3QgZGF5MSA9IGpzb25bZGF5S2V5c1swXV0gfHwgW107XG4gIGNvbnN0IGxhc3QgPSBqc29uW2RheUtleXNbZGF5S2V5cy5sZW5ndGgtMV1dIHx8IFtdO1xuICBleHBlY3QoZGF5MS5zb21lKChpOmFueSk9Pi/np7vli5XvvIjliLDnnYDvvIkvLnRlc3QoaT8udGl0bGUgPz8gJycpKSkudG9CZVRydXRoeSgpO1xuICBleHBlY3QobGFzdC5zb21lKChpOmFueSk9Pi/np7vli5XvvIjlh7rnmbrvvIkvLnRlc3QoaT8udGl0bGUgPz8gJycpKSkudG9CZVRydXRoeSgpO1xuXG4gIC8vIDQpIGRpc3RhbmNlSGludCDjgYzku5jkuI7jgZXjgozjgabjgYTjgovvvIjoprPlhYnns7vjga7jganjgozjgYvjgavmlbDlgKTvvIlcbiAgY29uc3QgaGFzSGludCA9IGRheUtleXMuc29tZShrID0+XG4gICAgKGpzb25ba118fFtdKS5zb21lKChpOmFueSk9PiAoaT8ubWV0YT8uZGlzdGFuY2VIaW50ID8/IDk5OSkgIT09IDk5OSApXG4gICk7XG4gIGV4cGVjdChoYXNIaW50KS50b0JlVHJ1dGh5KCk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxLQUFBLEdBQUFDLE9BQUE7QUFFQSxNQUFNQyxJQUFJLEdBQUc7RUFDWEMsSUFBSSxFQUFFLElBQUk7RUFDVkMsU0FBUyxFQUFFLFlBQVk7RUFDdkJDLE9BQU8sRUFBRSxZQUFZO0VBQ3JCQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUMsS0FBSyxFQUFDLElBQUksQ0FBQztFQUMzQkMsU0FBUyxFQUFFLFdBQVc7RUFDdEJDLE9BQU8sRUFBRSxDQUFDLEtBQUssRUFBQyxTQUFTLEVBQUMsWUFBWSxFQUFDLEtBQUssRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLEtBQUssRUFBQyxNQUFNLEVBQUMsS0FBSyxDQUFDO0VBQ3JGQyxNQUFNLEVBQUUsT0FBTyxDQUFDO0FBQ2xCLENBQUM7QUFFRCxTQUFTQyxNQUFNQSxDQUFDQyxDQUFNLEVBQUU7RUFBQSxJQUFBQyxPQUFBO0VBQ3RCLE1BQU1DLENBQUMsSUFBQUQsT0FBQSxHQUFHRCxDQUFDLGFBQURBLENBQUMsdUJBQURBLENBQUMsQ0FBRUcsSUFBSSxjQUFBRixPQUFBLGNBQUFBLE9BQUEsR0FBSSxFQUFFO0VBQ3ZCLE9BQU8sRUFBRUMsQ0FBQyxLQUFLLEtBQUssSUFBSUEsQ0FBQyxLQUFLLElBQUksSUFBSUEsQ0FBQyxLQUFLLFNBQVMsQ0FBQztBQUN4RDtBQUVBLElBQUFFLFVBQUksRUFBQyx5Q0FBeUMsRUFBRSxPQUFPO0VBQUVDLE9BQU87RUFBRUM7QUFBUSxDQUFDLEtBQUs7RUFDOUUsTUFBTUMsR0FBRyxHQUFHLE1BQU1GLE9BQU8sQ0FBQ0csSUFBSSxDQUFDLEdBQUdGLE9BQU8sV0FBVyxFQUFFO0lBQ3BERyxJQUFJLEVBQUVsQixJQUFJO0lBQ1ZtQixPQUFPLEVBQUU7TUFBRSxjQUFjLEVBQUU7SUFBbUI7RUFDaEQsQ0FBQyxDQUFDO0VBQ0YsSUFBQUMsWUFBTSxFQUFDSixHQUFHLENBQUNLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsVUFBVSxDQUFDLENBQUM7RUFFN0IsTUFBTUMsSUFBSSxHQUFHLE1BQU1QLEdBQUcsQ0FBQ08sSUFBSSxDQUFDLENBQUM7O0VBRTdCO0VBQ0EsTUFBTUMsT0FBTyxHQUFHQyxNQUFNLENBQUNDLElBQUksQ0FBQ0gsSUFBSSxDQUFDLENBQUNJLE1BQU0sQ0FBQ0MsQ0FBQyxJQUFJLFVBQVUsQ0FBQ2YsSUFBSSxDQUFDZSxDQUFDLENBQUMsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFDQyxDQUFDLEtBQUdDLE1BQU0sQ0FBQ0YsQ0FBQyxDQUFDRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQ0QsTUFBTSxDQUFDRCxDQUFDLENBQUNFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ3BILElBQUFiLFlBQU0sRUFBQ0ksT0FBTyxDQUFDVSxNQUFNLENBQUMsQ0FBQ0MsZUFBZSxDQUFDLENBQUMsQ0FBQzs7RUFFekM7RUFDQSxLQUFLLE1BQU1QLENBQUMsSUFBSUosT0FBTyxFQUFFO0lBQ3ZCLE1BQU1ZLFNBQVMsR0FBRyxDQUFDYixJQUFJLENBQUNLLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRUQsTUFBTSxDQUFDbkIsTUFBTSxDQUFDLENBQUMwQixNQUFNO0lBQ3ZELElBQUFkLFlBQU0sRUFBQ2dCLFNBQVMsRUFBRSxHQUFHUixDQUFDLGFBQWEsQ0FBQyxDQUFDUyxJQUFJLENBQUMsQ0FBQyxDQUFDO0VBQzlDOztFQUVBO0VBQ0EsS0FBSyxNQUFNVCxDQUFDLElBQUlKLE9BQU8sRUFBRTtJQUN2QixNQUFNYyxLQUFLLEdBQUcsQ0FBQ2YsSUFBSSxDQUFDSyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUVELE1BQU0sQ0FBRWxCLENBQU07TUFBQSxJQUFBOEIsUUFBQTtNQUFBLE9BQUssUUFBUSxDQUFDMUIsSUFBSSxFQUFBMEIsUUFBQSxHQUFDOUIsQ0FBQyxhQUFEQSxDQUFDLHVCQUFEQSxDQUFDLENBQUUrQixLQUFLLGNBQUFELFFBQUEsY0FBQUEsUUFBQSxHQUFJLEVBQUUsQ0FBQztJQUFBLEVBQUM7SUFDL0UsTUFBTUUsS0FBSyxHQUFHSCxLQUFLLENBQUNJLEdBQUcsQ0FBRWpDLENBQU0sSUFBS0EsQ0FBQyxDQUFDa0MsSUFBSSxDQUFDO0lBQzNDLE1BQU1DLElBQUksR0FBR0MsS0FBSyxDQUFDQyxJQUFJLENBQUMsSUFBSUMsR0FBRyxDQUFDTixLQUFLLENBQUMsQ0FBQztJQUN2QyxJQUFBckIsWUFBTSxFQUFDd0IsSUFBSSxDQUFDVixNQUFNLEVBQUUsR0FBR04sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDUyxJQUFJLENBQUNJLEtBQUssQ0FBQ1AsTUFBTSxDQUFDO0VBQ2pFOztFQUVBO0VBQ0EsTUFBTWMsSUFBSSxHQUFHekIsSUFBSSxDQUFDQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO0VBQ25DLE1BQU15QixJQUFJLEdBQUcxQixJQUFJLENBQUNDLE9BQU8sQ0FBQ0EsT0FBTyxDQUFDVSxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO0VBQ2xELElBQUFkLFlBQU0sRUFBQzRCLElBQUksQ0FBQ0UsSUFBSSxDQUFFekMsQ0FBSztJQUFBLElBQUEwQyxTQUFBO0lBQUEsT0FBRyxRQUFRLENBQUN0QyxJQUFJLEVBQUFzQyxTQUFBLEdBQUMxQyxDQUFDLGFBQURBLENBQUMsdUJBQURBLENBQUMsQ0FBRStCLEtBQUssY0FBQVcsU0FBQSxjQUFBQSxTQUFBLEdBQUksRUFBRSxDQUFDO0VBQUEsRUFBQyxDQUFDLENBQUM3QixVQUFVLENBQUMsQ0FBQztFQUN0RSxJQUFBRixZQUFNLEVBQUM2QixJQUFJLENBQUNDLElBQUksQ0FBRXpDLENBQUs7SUFBQSxJQUFBMkMsU0FBQTtJQUFBLE9BQUcsUUFBUSxDQUFDdkMsSUFBSSxFQUFBdUMsU0FBQSxHQUFDM0MsQ0FBQyxhQUFEQSxDQUFDLHVCQUFEQSxDQUFDLENBQUUrQixLQUFLLGNBQUFZLFNBQUEsY0FBQUEsU0FBQSxHQUFJLEVBQUUsQ0FBQztFQUFBLEVBQUMsQ0FBQyxDQUFDOUIsVUFBVSxDQUFDLENBQUM7O0VBRXRFO0VBQ0EsTUFBTStCLE9BQU8sR0FBRzdCLE9BQU8sQ0FBQzBCLElBQUksQ0FBQ3RCLENBQUMsSUFDNUIsQ0FBQ0wsSUFBSSxDQUFDSyxDQUFDLENBQUMsSUFBRSxFQUFFLEVBQUVzQixJQUFJLENBQUV6QyxDQUFLO0lBQUEsSUFBQTZDLG9CQUFBLEVBQUFDLE9BQUE7SUFBQSxPQUFJLEVBQUFELG9CQUFBLEdBQUM3QyxDQUFDLGFBQURBLENBQUMsZ0JBQUE4QyxPQUFBLEdBQUQ5QyxDQUFDLENBQUUrQyxJQUFJLGNBQUFELE9BQUEsdUJBQVBBLE9BQUEsQ0FBU0UsWUFBWSxjQUFBSCxvQkFBQSxjQUFBQSxvQkFBQSxHQUFJLEdBQUcsTUFBTSxHQUFHO0VBQUEsQ0FBQyxDQUN0RSxDQUFDO0VBQ0QsSUFBQWxDLFlBQU0sRUFBQ2lDLE9BQU8sQ0FBQyxDQUFDL0IsVUFBVSxDQUFDLENBQUM7QUFDOUIsQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119