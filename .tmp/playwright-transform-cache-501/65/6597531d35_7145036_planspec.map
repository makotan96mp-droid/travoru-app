{"version":3,"names":["_test","require","seed","city","startDate","endDate","purposes","hotelName","mustSee","policy","isMain","i","_i$type","t","type","test","request","baseURL","res","post","data","headers","expect","ok","toBeTruthy","json","dayKeys","Object","keys","filter","k","sort","a","b","Number","slice","length","toBeGreaterThan","mainCount","toBe","meals","_i$title","title","times","map","time","uniq","Array","from","Set","day1","last","some","_i$title2","_i$title3","hasHint","_i$meta$distanceHint","_i$meta","meta","distanceHint"],"sources":["plan.spec.ts"],"sourcesContent":["import { test, expect } from '@playwright/test';\n\nconst seed = {\n  city: \"大阪\",\n  startDate: \"2025-11-06\",\n  endDate: \"2025-11-10\",\n  purposes: [\"観光\",\"グルメ\",\"宿泊\"],\n  hotelName: \"ホテルモントレ大阪\",\n  mustSee: [\"USJ\",\"カニ道楽 本店\",\"アメリカ村（アメ村）\",\"通天閣\",\"大阪城\",\"梅田スカイビル 空中庭園\",\"道頓堀\",\"黒門市場\",\"海遊館\"],\n  policy: \"nomal\" // 誤記も normal として扱われるか\n};\n\nfunction isMain(i: any) {\n  const t = i?.type ?? \"\";\n  return !(t === \"グルメ\" || t === \"移動\" || t === \"プレースホルダ\");\n}\n\ntest('B方針: 各日メイン2枠固定 & ランチ/夕食重複なし & 到着/出発移動あり', async ({ request, baseURL }) => {\n  const res = await request.post(`${baseURL}/api/plan`, {\n    data: seed,\n    headers: { 'content-type': 'application/json' }\n  });\n  expect(res.ok()).toBeTruthy();\n\n  const json = await res.json();\n\n  // dayキーを抽出・昇順\n  const dayKeys = Object.keys(json).filter(k => /^day\\d+$/.test(k)).sort((a,b)=>Number(a.slice(3))-Number(b.slice(3)));\n  expect(dayKeys.length).toBeGreaterThan(0);\n\n  // 1) 各日メイン2件\n  for (const k of dayKeys) {\n    const mainCount = (json[k] || []).filter(isMain).length;\n    expect(mainCount, `${k} main count`).toBe(2);\n  }\n\n  // 2) ランチ/夕食の時刻重複なし\n  for (const k of dayKeys) {\n    const meals = (json[k] || []).filter((i: any) => /ランチ|夕食/.test(i?.title ?? ''));\n    const times = meals.map((i: any) => i.time);\n    const uniq = Array.from(new Set(times));\n    expect(uniq.length, `${k} meal time unique`).toBe(times.length);\n  }\n\n  // 3) 到着/出発の移動行が入っている\n  const day1 = json[dayKeys[0]] || [];\n  const last = json[dayKeys[dayKeys.length-1]] || [];\n  expect(day1.some((i:any)=>/移動（到着）/.test(i?.title ?? ''))).toBeTruthy();\n  expect(last.some((i:any)=>/移動（出発）/.test(i?.title ?? ''))).toBeTruthy();\n\n  // 4) distanceHint が付与されている（観光系のどれかに数値）\n  const hasHint = dayKeys.some(k =>\n    (json[k]||[]).some((i:any)=> (i?.meta?.distanceHint ?? 999) !== 999 )\n  );\n  expect(hasHint).toBeTruthy();\n});\n"],"mappings":"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","ignoreList":[]}