{"version":3,"names":["_test","require","_helpers","test","page","addInitScript","window","__printed","print","__clips","__prompts","__execCopies","navigator","clipboard","writeText","t","push","String","origPrompt","prompt","msg","_def","_execCommand","origExec","document","execCommand","bind","cmd","toLowerCase","waitDemoReady","expect","openMenu","toBeTruthy","panel","menuPanelLocator","toBeVisible","getByTestId","c0","p0","e0","evaluate","_clips","_prompts","length","click","waitForFunction","beforeClips","beforePrompts","beforeExec","clips","prompts","execs","c","Array","isArray","p","timeout","copied","prompted","slice","toMatch","toBeGreaterThan","poll","toBe"],"sources":["menu-contents.spec.ts"],"sourcesContent":["import { test, expect } from \"@playwright/test\";\nimport type { Page } from \"@playwright/test\";\nimport { waitDemoReady, openMenu, menuPanelLocator } from \"./helpers\";\n\ntest(\"メニュー: 共有/カレンダー/印刷/JSON読み込み が並ぶ\", async ({ page }) => {\n  // print をスタブ & クリップボード/プロンプト/execCommand を記録つきでスタブ\n  await page.addInitScript(() => {\n    (window as any).__printed = false;\n    (window as any).print = () => {\n      (window as any).__printed = true;\n    };\n\n    (window as any).__clips = [];\n    (window as any).__prompts = [];\n    (window as any).__execCopies = 0;\n\n    // clipboard.writeText の記録\n    try {\n      (window as any).navigator.clipboard = {\n        writeText: async (t: any) => {\n          (window as any).__clips.push(String(t));\n        },\n      };\n    } catch {}\n\n    // prompt フォールバックの記録\n    try {\n      const origPrompt = window.prompt;\n      (window as any).prompt = (msg?: string, _def?: string) => {\n        (window as any).__prompts.push(String(msg || \"\"));\n        return \"\"; // 自動で閉じる\n      };\n    } catch {}\n\n    // execCommand('copy') フォールバックの記録\n    try {\n      const origExec = (document as any).execCommand?.bind(document);\n      (document as any).execCommand = (cmd: string) => {\n        if (String(cmd).toLowerCase() === \"copy\") (window as any).__execCopies++;\n        try {\n          return origExec ? origExec(cmd) : true;\n        } catch {\n          return true;\n        }\n      };\n    } catch {}\n  });\n\n  await waitDemoReady(page as Page);\n  await expect(await openMenu(page as Page)).toBeTruthy();\n\n  const panel = await menuPanelLocator(page as any);\n  await expect(panel).toBeVisible();\n\n  await expect(page.getByTestId(\"menu-share-link\")).toBeVisible();\n  await expect(page.getByTestId(\"menu-calendar\")).toBeVisible();\n  await expect(page.getByTestId(\"menu-print\")).toBeVisible();\n  await expect(page.getByTestId(\"menu-json-import\")).toBeVisible();\n\n  // 共有リンク → clipboard / prompt / execCommand のいずれか発火を検証\n  const [c0, p0, e0] = await page.evaluate(() => [\n    (window as any).__clips?.length || 0,\n    (window as any).__prompts?.length || 0,\n    (window as any).__execCopies || 0,\n  ]);\n\n  await page.getByTestId(\"menu-share-link\").click();\n\n  await page.waitForFunction(\n    (beforeClips, beforePrompts, beforeExec) => {\n      const clips = (window as any).__clips;\n      const prompts = (window as any).__prompts;\n      const execs = (window as any).__execCopies || 0;\n      const c = Array.isArray(clips) ? clips.length : 0;\n      const p = Array.isArray(prompts) ? prompts.length : 0;\n      return c > beforeClips || p > beforePrompts || execs > beforeExec;\n    },\n    { timeout: 10000 },\n    c0,\n    p0,\n    e0,\n  );\n\n  // 取れれば URL も検証（取れないケース＝execCommand のみは回数増加で合格）\n  const { copied, prompted, execs } = await page.evaluate(() => ({\n    copied: ((window as any).__clips || []).slice(-1)[0] || \"\",\n    prompted: ((window as any).__prompts || []).slice(-1)[0] || \"\",\n    execs: (window as any).__execCopies || 0,\n  }));\n\n  if (copied) {\n    expect(copied).toMatch(/\\/demo-itinerary\\?(?:plan|plan_gz)=/);\n  } else if (prompted) {\n    expect(prompted).toMatch(/\\/demo-itinerary\\?(?:plan|plan_gz)=/);\n  } else {\n    expect(execs).toBeGreaterThan(e0); // execCommandのみでもOK\n  }\n\n  // 再オープンして印刷 → スタブで確認\n  await expect(await openMenu(page as Page)).toBeTruthy();\n  await page.getByTestId(\"menu-print\").click();\n  await expect\n    .poll(async () => await page.evaluate(() => (window as any).__printed === true))\n    .toBe(true);\n});\n"],"mappings":"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","ignoreList":[]}