name: api-plan
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with: { node-version: '20' }
    - run: corepack enable
    - run: pnpm i --frozen-lockfile
    - run: pnpm dev:3001 &
    - run: |
        for i in {1..40}; do
          curl -sf http://localhost:3001/ >/dev/null && break
          sleep 0.5
        done
    - run: pnpm run test:api
